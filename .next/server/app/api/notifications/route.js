"use strict";(()=>{var e={};e.id=1996,e.ids=[1996],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},45293:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>v,patchFetch:()=>A,requestAsyncStorage:()=>w,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>q});var i={};r.r(i),r.d(i,{GET:()=>f,POST:()=>m});var n=r(95419),a=r(69108),s=r(99678),o=r(78070),u=r(53524),c=r(81355),l=r(50442),p=r(95413);let d=new u.PrismaClient;async function f(e){try{let t=await (0,c.getServerSession)(l.L);if(!t?.user?.id)return o.Z.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),i=parseInt(r.get("page")||"1"),n=parseInt(r.get("limit")||"20"),a=(i-1)*n,s=await d.notification.findMany({where:{userId:t.user.id},orderBy:{createdAt:"desc"},skip:a,take:n}),u=await d.notification.count({where:{userId:t.user.id}});return o.Z.json({notifications:s,pagination:{page:i,limit:n,total:u,totalPages:Math.ceil(u/n)}})}catch(e){return console.error("Error fetching notifications:",e),o.Z.json({error:"Failed to fetch notifications"},{status:500})}}async function m(e){try{let t=await (0,c.getServerSession)(l.L);if(!t?.user?.id)return o.Z.json({error:"Unauthorized"},{status:401});let{type:r,message:i,userId:n,relatedUserId:a,postId:s}=await e.json(),u=await d.notification.create({data:{type:r,message:i,userId:n,relatedUserId:a,relatedPostId:s}});return(0,p.zz)(n,{type:"new_notification",notification:{id:u.id,type:u.type,message:u.message,createdAt:u.createdAt,read:u.read,relatedUserId:u.relatedUserId}}),o.Z.json(u)}catch(e){return console.error("Error creating notification:",e),o.Z.json({error:"Failed to create notification"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/notifications/route",pathname:"/api/notifications",filename:"route",bundlePath:"app/api/notifications/route"},resolvedPagePath:"/Users/michaelmartinez/My Stuff/Software Development/BlueSky Clone/app/api/notifications/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:w,staticGenerationAsyncStorage:h,serverHooks:x,headerHooks:y,staticGenerationBailout:q}=g,v="/api/notifications/route";function A(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},50442:(e,t,r)=>{r.d(t,{L:()=>d,Z:()=>f});var i=r(81355),n=r.n(i),a=r(65822),s=r(53524),o=r(86485),u=r(6521),c=r.n(u);let l=new s.PrismaClient,p=Object.entries({NEXTAUTH_SECRET:process.env.NEXTAUTH_SECRET,NEXTAUTH_URL:process.env.NEXTAUTH_URL,DATABASE_URL:process.env.DATABASE_URL}).filter(([e,t])=>!t).map(([e])=>e);p.length>0&&console.warn(`Missing required environment variables: ${p.join(", ")}`);let d={adapter:(0,a.N)(l),providers:[(0,o.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let t=await l.user.findUnique({where:{email:e.email}});if(!t||!t.password||!await c().compare(e.password,t.password))return null;return{id:t.id,email:t.email||"",name:t.name||"",username:t.username}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt",maxAge:2592e3,updateAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.username=t.username),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.username=t.username),e),redirect:async({url:e,baseUrl:t})=>e.startsWith("/")?`${t}${e}`:new URL(e).origin===t?e:t},pages:{signIn:"/login",signUp:"/signup"},secret:process.env.NEXTAUTH_SECRET||"fallback-secret-for-development",debug:!1},f=n()(d)},95413:(e,t,r)=>{r.d(t,{HE:()=>a,xI:()=>s,zz:()=>n});let i=new Map;function n(e,t){let r=i.get(e);if(r)try{r.enqueue(`data: ${JSON.stringify(t)}

`)}catch(t){console.error("Error sending notification:",t),i.delete(e)}}function a(e,t){i.set(e,t)}function s(e){i.delete(e)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[1638,6206,6521,9155],()=>r(45293));module.exports=i})();