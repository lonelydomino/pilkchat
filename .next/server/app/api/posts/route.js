"use strict";(()=>{var e={};e.id=990,e.ids=[990],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},95532:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>q,originalPathname:()=>v,patchFetch:()=>I,requestAsyncStorage:()=>w,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>y});var s={};r.r(s),r.d(s,{GET:()=>m,POST:()=>h});var a=r(95419),i=r(69108),n=r(99678),o=r(78070),u=r(53524),p=r(81355),d=r(50442),l=r(95752);let c=new u.PrismaClient;async function m(e){try{let e=await (0,p.getServerSession)(d.L),t=e?.user?.id,r=await c.post.findMany({where:{published:!0},include:{author:{select:{id:!0,name:!0,username:!0,image:!0}},hashtags:{include:{hashtag:!0}},_count:{select:{likes:!0,comments:!0,reposts:!0}}},orderBy:{createdAt:"desc"},take:50}),s=await Promise.all(r.map(async e=>{let r=!1,s=!1,a=!1;if(t){let[i,n,o]=await Promise.all([c.like.findUnique({where:{userId_postId:{userId:t,postId:e.id}}}),c.repost.findUnique({where:{userId_postId:{userId:t,postId:e.id}}}),c.bookmark.findUnique({where:{userId_postId:{userId:t,postId:e.id}}})]);r=!!i,s=!!n,a=!!o}return{...e,hashtags:e.hashtags.map(e=>e.hashtag),isLiked:r,isReposted:s,isBookmarked:a}}));return o.Z.json({posts:s})}catch(e){return console.error("Error fetching posts:",e),o.Z.json({error:"Failed to fetch posts"},{status:500})}}async function h(e){try{let t=await (0,p.getServerSession)(d.L);if(!t?.user?.id)return o.Z.json({error:"Unauthorized"},{status:401});let{content:r,mediaUrls:s=[]}=await e.json();if(!r?.trim()&&0===s.length)return o.Z.json({error:"Post content or media is required"},{status:400});let a=(0,l.Ef)(r),i=await c.post.create({data:{content:r?.trim()||"",authorId:t.user.id,mediaUrls:s},include:{author:{select:{id:!0,name:!0,username:!0,image:!0}},_count:{select:{likes:!0,comments:!0,reposts:!0}}}});a.length>0&&await Promise.all(a.map(async e=>{let t=await c.hashtag.findUnique({where:{name:e}});t||(t=await c.hashtag.create({data:{name:e}})),await c.postHashtag.create({data:{postId:i.id,hashtagId:t.id}})}));let n={...i,hashtags:a.map(e=>({name:e})),isLiked:!1,isReposted:!1,isBookmarked:!1};return o.Z.json(n)}catch(e){return console.error("Error creating post:",e),o.Z.json({error:"Failed to create post"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/posts/route",pathname:"/api/posts",filename:"route",bundlePath:"app/api/posts/route"},resolvedPagePath:"/Users/michaelmartinez/My Stuff/Software Development/BlueSky Clone/app/api/posts/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:f,serverHooks:x,headerHooks:q,staticGenerationBailout:y}=g,v="/api/posts/route";function I(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},50442:(e,t,r)=>{r.d(t,{L:()=>l,Z:()=>c});var s=r(81355),a=r.n(s),i=r(65822),n=r(53524),o=r(86485),u=r(6521),p=r.n(u);let d=new n.PrismaClient,l={adapter:(0,i.N)(d),providers:[(0,o.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await d.user.findUnique({where:{email:e.email}});return t&&t.password&&await p().compare(e.password,t.password)?{id:t.id,email:t.email||"",name:t.name||"",username:t.username}:null}})],session:{strategy:"jwt",maxAge:2592e3,updateAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.username=t.username),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.sub,e.user.username=t.username),e),redirect:async({url:e,baseUrl:t})=>e.startsWith("/")?`${t}${e}`:new URL(e).origin===t?e:t},pages:{signIn:"/login",signUp:"/signup"},secret:process.env.NEXTAUTH_SECRET},c=a()(l)},95752:(e,t,r)=>{r.d(t,{Ef:()=>n,cn:()=>i});var s=r(70990),a=r(81774);function i(...e){return(0,a.m6)((0,s.W)(e))}function n(e){let t=e.match(/#[\w\u0590-\u05ff]+/g);return t?Array.from(new Set(t.map(e=>e.slice(1).toLowerCase()))):[]}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,6206,6521,9155,4345],()=>r(95532));module.exports=s})();