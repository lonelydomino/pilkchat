"use strict";(()=>{var e={};e.id=990,e.ids=[990],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},95532:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>q,originalPathname:()=>v,patchFetch:()=>A,requestAsyncStorage:()=>w,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>y});var s={};t.r(s),t.d(s,{GET:()=>m,POST:()=>h});var a=t(95419),n=t(69108),i=t(99678),o=t(78070),u=t(53524),l=t(81355),p=t(50442),d=t(95752);let c=new u.PrismaClient;async function m(e){try{let e=await (0,l.getServerSession)(p.L),r=e?.user?.id,t=await c.post.findMany({where:{published:!0},include:{author:{select:{id:!0,name:!0,username:!0,image:!0}},hashtags:{include:{hashtag:!0}},_count:{select:{likes:!0,comments:!0,reposts:!0}}},orderBy:{createdAt:"desc"},take:50}),s=await Promise.all(t.map(async e=>{let t=!1,s=!1,a=!1;if(r){let[n,i,o]=await Promise.all([c.like.findUnique({where:{userId_postId:{userId:r,postId:e.id}}}),c.repost.findUnique({where:{userId_postId:{userId:r,postId:e.id}}}),c.bookmark.findUnique({where:{userId_postId:{userId:r,postId:e.id}}})]);t=!!n,s=!!i,a=!!o}return{...e,hashtags:e.hashtags.map(e=>e.hashtag),isLiked:t,isReposted:s,isBookmarked:a}}));return o.Z.json({posts:s})}catch(e){return console.error("Error fetching posts:",e),o.Z.json({error:"Failed to fetch posts"},{status:500})}}async function h(e){try{let r=await (0,l.getServerSession)(p.L);if(!r?.user?.id)return o.Z.json({error:"Unauthorized"},{status:401});let{content:t,mediaUrls:s=[]}=await e.json();if(!t?.trim()&&0===s.length)return o.Z.json({error:"Post content or media is required"},{status:400});let a=(0,d.Ef)(t),n=await c.post.create({data:{content:t?.trim()||"",authorId:r.user.id,mediaUrls:s},include:{author:{select:{id:!0,name:!0,username:!0,image:!0}},_count:{select:{likes:!0,comments:!0,reposts:!0}}}});a.length>0&&await Promise.all(a.map(async e=>{let r=await c.hashtag.findUnique({where:{name:e}});r||(r=await c.hashtag.create({data:{name:e}})),await c.postHashtag.create({data:{postId:n.id,hashtagId:r.id}})}));let i={...n,hashtags:a.map(e=>({name:e})),isLiked:!1,isReposted:!1,isBookmarked:!1};return o.Z.json(i)}catch(e){return console.error("Error creating post:",e),o.Z.json({error:"Failed to create post"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/posts/route",pathname:"/api/posts",filename:"route",bundlePath:"app/api/posts/route"},resolvedPagePath:"/Users/michaelmartinez/My Stuff/Software Development/BlueSky Clone/app/api/posts/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:f,serverHooks:x,headerHooks:q,staticGenerationBailout:y}=g,v="/api/posts/route";function A(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},50442:(e,r,t)=>{t.d(r,{L:()=>c,Z:()=>m});var s=t(81355),a=t.n(s),n=t(65822),i=t(53524),o=t(86485),u=t(6521),l=t.n(u);let p=new i.PrismaClient,d=Object.entries({NEXTAUTH_SECRET:process.env.NEXTAUTH_SECRET,NEXTAUTH_URL:process.env.NEXTAUTH_URL,DATABASE_URL:process.env.DATABASE_URL}).filter(([e,r])=>!r).map(([e])=>e);d.length>0&&console.warn(`Missing required environment variables: ${d.join(", ")}`);let c={adapter:(0,n.N)(p),providers:[(0,o.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{let r=await p.user.findUnique({where:{email:e.email}});if(!r||!r.password||!await l().compare(e.password,r.password))return null;return{id:r.id,email:r.email||"",name:r.name||"",username:r.username}}catch(e){return console.error("Auth error:",e),null}}})],session:{strategy:"jwt",maxAge:2592e3,updateAge:86400},callbacks:{jwt:async({token:e,user:r})=>(r&&(e.username=r.username),e),session:async({session:e,token:r})=>(r&&(e.user.id=r.sub,e.user.username=r.username),e),redirect:async({url:e,baseUrl:r})=>e.startsWith("/")?`${r}${e}`:new URL(e).origin===r?e:r},pages:{signIn:"/login",signUp:"/signup"},secret:process.env.NEXTAUTH_SECRET||"fallback-secret-for-development",debug:!1},m=a()(c)},95752:(e,r,t)=>{t.d(r,{Ef:()=>i,cn:()=>n});var s=t(70990),a=t(81774);function n(...e){return(0,a.m6)((0,s.W)(e))}function i(e){let r=e.match(/#[\w\u0590-\u05ff]+/g);return r?Array.from(new Set(r.map(e=>e.slice(1).toLowerCase()))):[]}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,6521,9155,4345],()=>t(95532));module.exports=s})();